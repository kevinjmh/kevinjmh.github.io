
 <!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  
    <title>hdfs | Manhua</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Manhua">
    

    
    <meta name="description" content="文件保护删除hdfs删除逻辑为，路径上所有需要删除的文件节点的父目录有w权限 即：即使A用户是根目录的所有者，只要A创建&#x2F;允许创建了B用户的目录且该目录下有数据，只要A不是超级用户则不能删除。注意若该目录下无文件，则该目录依然能被删除。 操作方式启动：使用hdfs用户启动hadoop服务 任务部署：ds， 上传jar包、运行任务都将以hadoop运行，生产是数据hadoop写出为755 个人调试&#x2F;">
<meta property="og:type" content="article">
<meta property="og:title" content="hdfs">
<meta property="og:url" content="http://kevinjmh.github.io/2022/01/20/CheatSheet/storage/hdfs/index.html">
<meta property="og:site_name" content="Manhua">
<meta property="og:description" content="文件保护删除hdfs删除逻辑为，路径上所有需要删除的文件节点的父目录有w权限 即：即使A用户是根目录的所有者，只要A创建&#x2F;允许创建了B用户的目录且该目录下有数据，只要A不是超级用户则不能删除。注意若该目录下无文件，则该目录依然能被删除。 操作方式启动：使用hdfs用户启动hadoop服务 任务部署：ds， 上传jar包、运行任务都将以hadoop运行，生产是数据hadoop写出为755 个人调试&#x2F;">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-01-20T14:11:43.000Z">
<meta property="article:modified_time" content="2023-12-21T09:47:33.956Z">
<meta property="article:author" content="Manhua">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@jiangmanhua">

    
    <link rel="alternative" href="/atom.xml" title="Manhua" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.0.0"></head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="Manhua" title="Manhua"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Manhua">Manhua</a></h1>
				<h2 class="blog-motto">Never Say Die</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页 | Home</a></li>
					
						<li><a href="/archives">归档 | Archives</a></li>
					
						<li><a href="/about">简介 | About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:kevinjmh.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2022/01/20/CheatSheet/storage/hdfs/" title="hdfs" itemprop="url">hdfs</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Manhua" target="_blank" itemprop="author">Manhua</a>
		
  <p class="article-time">
    <time datetime="2022-01-20T14:11:43.000Z" itemprop="datePublished"> Published 2022-01-20</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%BF%9D%E6%8A%A4%E5%88%A0%E9%99%A4"><span class="toc-number">1.</span> <span class="toc-text">文件保护删除</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%96%B9%E5%BC%8F"><span class="toc-number">1.1.</span> <span class="toc-text">操作方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%9D%83%E9%99%90"><span class="toc-number">1.2.</span> <span class="toc-text">配置权限</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#hadoop-policy-xml"><span class="toc-number">2.</span> <span class="toc-text">hadoop-policy.xml</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#yarn-site"><span class="toc-number">3.</span> <span class="toc-text">yarn-site</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B7%A8%E9%9B%86%E7%BE%A4%E5%A4%8D%E5%88%B6"><span class="toc-number">4.</span> <span class="toc-text">跨集群复制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E5%AE%B9%E9%87%8F%E9%99%90%E5%88%B6"><span class="toc-number">4.1.</span> <span class="toc-text">目录容量限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#webhdfs%E4%BD%BF%E7%94%A8"><span class="toc-number">4.2.</span> <span class="toc-text">webhdfs使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%BA%E6%9E%B6%E6%84%9F%E7%9F%A5"><span class="toc-number">4.3.</span> <span class="toc-text">机架感知</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E6%96%87%E4%BB%B6%E5%90%88%E5%B9%B6"><span class="toc-number">4.4.</span> <span class="toc-text">小文件合并</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%AD%E8%B7%AF%E8%AF%BB"><span class="toc-number">4.5.</span> <span class="toc-text">短路读</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%96%E7%BD%AE%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AEwithKerberos"><span class="toc-number">4.6.</span> <span class="toc-text">外置客户端配置withKerberos</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%89%AF%E6%9C%AC%E6%95%B0"><span class="toc-number">5.</span> <span class="toc-text">修改副本数</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#distcp"><span class="toc-number">6.</span> <span class="toc-text">distcp</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E9%98%9F%E5%88%97"><span class="toc-number">6.1.</span> <span class="toc-text">指定队列</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E6%8B%B7sftp"><span class="toc-number">6.2.</span> <span class="toc-text">对拷sftp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8C%E6%97%B6%E8%AE%BF%E9%97%AE%E4%B8%A4%E4%B8%AAHA%E9%9B%86%E7%BE%A4"><span class="toc-number">6.3.</span> <span class="toc-text">同时访问两个HA集群</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-%E8%AF%BB%E5%8F%96%E5%A4%9A%E4%B8%AA%E6%9E%9A%E4%B8%BE%E5%80%BC%E8%B7%AF%E5%BE%84"><span class="toc-number">7.</span> <span class="toc-text">使用{}读取多个枚举值路径</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E4%B8%A2%E5%A4%B1%E5%A4%84%E7%90%86"><span class="toc-number">8.</span> <span class="toc-text">数据丢失处理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HDFS%E6%96%87%E4%BB%B6%E6%B8%85%E7%90%86%E5%B7%A1%E6%A3%80"><span class="toc-number">9.</span> <span class="toc-text">HDFS文件清理巡检</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#balance"><span class="toc-number">10.</span> <span class="toc-text">balance</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B8%85%E7%A9%BA%E5%9B%9E%E6%94%B6%E7%AB%99"><span class="toc-number">11.</span> <span class="toc-text">清空回收站</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Web%E9%A1%B5%E9%9D%A2%E5%AE%89%E5%85%A8"><span class="toc-number">12.</span> <span class="toc-text">Web页面安全</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87nginx%E9%85%8D%E7%BD%AE%E7%94%A8%E6%88%B7%E5%90%8D%E5%AF%86%E7%A0%81"><span class="toc-number">12.1.</span> <span class="toc-text">通过nginx配置用户名密码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GroupMapping%E9%85%8D%E7%BD%AE"><span class="toc-number">13.</span> <span class="toc-text">GroupMapping配置</span></a></li></ol>
		
		</div>
		
		<h1 id="文件保护删除"><a href="#文件保护删除" class="headerlink" title="文件保护删除"></a>文件保护删除</h1><p>hdfs删除逻辑为，路径上所有需要删除的文件节点的父目录有w权限</p>
<p>即：即使A用户是根目录的所有者，只要A创建/允许创建了B用户的目录且该目录下有数据，只要A不是超级用户则不能删除。注意若该目录下无文件，则该目录依然能被删除。</p>
<h2 id="操作方式"><a href="#操作方式" class="headerlink" title="操作方式"></a>操作方式</h2><p>启动：使用hdfs用户启动hadoop服务</p>
<p>任务部署：ds， 上传jar包、运行任务都将以hadoop运行，生产是数据hadoop写出为755</p>
<p>个人调试/查看数据：可以本地执行hadoop/spark/flink命令执行</p>
<p>数据保护：定期修改关键数据为hdfs用户下755，只有hdfs可删除文件</p>
<p>hdfs dfs -chown hdfs xxx<br>#hdfs dfs -chmod  -R 755 xxx</p>
<h2 id="配置权限"><a href="#配置权限" class="headerlink" title="配置权限"></a>配置权限</h2><p>hdfs-site.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.permissions.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.namenode.acls.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>单个用户设置权限<br>增加ACL: hdfs dfs -setfacl -m user:jiangmanhua:rwx /hive/warehouse/label.db<br>递归增加ACL: hdfs dfs -setfacl -R -m user:hadoop:r-x /dir<br>删除ACL: hdfs dfs -setfacl -x user:hadoop /file<br>查询ACL: hdfs dfs -getfacl /hive/warehouse/label.db/<br>hdfs dfs -ls /hive/warehouse/label.db/</p>
<h1 id="hadoop-policy-xml"><a href="#hadoop-policy-xml" class="headerlink" title="hadoop-policy.xml"></a>hadoop-policy.xml</h1><p>yarn rmadmin -refreshServiceAcl<br>hadoop dfsadmin -refreshServiceAcl</p>
<p>基础开关<br>hadoop.security.authorization=true</p>
<p>控制提交任务/ JobTracker<br>security.job.client.protocol.acl</p>
<p>访问HDFS /NameNode<br>security.client.protocol.acl</p>
<h1 id="yarn-site"><a href="#yarn-site" class="headerlink" title="yarn-site"></a>yarn-site</h1><p>开启yarn ACLs:<br>hadoop: core-site.xml<br>hadoop.security.authorization=true  #开启服务级别验证,否则hadoop组件的acl设置不生效<br>yarn: yarn-site.xml<br><property><br><name>yarn.acl.enable</name><br><value>true</value><br></property><br><property><br><name>yarn.admin.acl</name><br><value>hdfs</value><br></property></p>
<p>$ vi $HADOOP_CONF_DIR/capacity-scheduler.xml<br>$ yarn rmadmin -refreshQueues</p>
<p><code>yarn.scheduler.capacity.root.&lt;queue-path&gt;.acl_submit_applications</code></p>
<h1 id="跨集群复制"><a href="#跨集群复制" class="headerlink" title="跨集群复制"></a>跨集群复制</h1><p>[Test case from new cluster]</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hadoop distcp hdfs://ip:9000/hive/spark-jars/metrics-core-4.1.1.jar /</span><br><span class="line">hadoop distcp /spark/lib/HikariCP-2.5.1.jar  hdfs://ip:9000/</span><br></pre></td></tr></table></figure>
<p>-update -skipcrccheck</p>
<h2 id="目录容量限制"><a href="#目录容量限制" class="headerlink" title="目录容量限制"></a>目录容量限制</h2><p>hdfs dfs -count -q -h /tmp/a<br>目录个数，文件个数，文件总计大小</p>
<p>文件数量<br>hdfs dfsadmin -setQuota 2 /tmp/a<br>清除限制<br>hdfs dfsadmin -clrQuota /tmp/a</p>
<p>文件大小<br>hdfs dfsadmin -setSpaceQuota 5M /tmp/a<br>清除限制<br>hdfs dfsadmin -clrSpaceQuota /tmp/a</p>
<h2 id="webhdfs使用"><a href="#webhdfs使用" class="headerlink" title="webhdfs使用"></a>webhdfs使用</h2><p><a target="_blank" rel="noopener" href="http://10.17.41.126:50070/explorer.html#/">http://10.17.41.126:50070/explorer.html#/</a></p>
<p>user.name=hadoop</p>
<p>List</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i  &quot;http://10.17.41.126:50070/webhdfs/v1/opendata?op=LISTSTATUS&quot;</span><br></pre></td></tr></table></figure>

<p>Create</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i -X PUT &quot;http://10.17.41.126:50070/webhdfs/v1/opendata/testFile?op=CREATE&amp;overwrite=false&amp;replication=1&quot;</span><br></pre></td></tr></table></figure>

<p>返回datanode信息：<br><a target="_blank" rel="noopener" href="http://lgjf-zyc6-hcy-svr553.cmic:50075/webhdfs/v1/opendata/testFile?op=CREATE&amp;namenoderpcaddress=LGJF-ZYC6-HCY-SVR553:9000&amp;createflag=&amp;createparent=true&amp;overwrite=false&amp;replication=1">http://LGJF-ZYC6-HCY-SVR553.cmic:50075/webhdfs/v1/opendata/testFile?op=CREATE&amp;namenoderpcaddress=LGJF-ZYC6-HCY-SVR553:9000&amp;createflag=&amp;createparent=true&amp;overwrite=false&amp;replication=1</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i -X PUT -T &lt;LOCAL_FILE&gt; &quot;http://LGJF-ZYC6-HCY-SVR553.cmic:50075/webhdfs/v1/opendata/testFile?&amp;op=CREATE&amp;namenoderpcaddress=LGJF-ZYC6-HCY-SVR553:9000&amp;createflag=&amp;createparent=true&amp;overwrite=false&amp;replication=1&quot;</span><br></pre></td></tr></table></figure>
<p>脚本化可参考：<a target="_blank" rel="noopener" href="https://github.com/pensz/hdfs_tools/tree/master/shell">https://github.com/pensz/hdfs_tools/tree/master/shell</a></p>
<p>控制容量 <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_30338481/article/details/94915052">https://blog.csdn.net/weixin_30338481/article/details/94915052</a></p>
<h2 id="机架感知"><a href="#机架感知" class="headerlink" title="机架感知"></a>机架感知</h2><p>core-default.xml中增加配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt; </span><br><span class="line">&lt;name&gt;net.topology.script.file.name&lt;/name&gt; </span><br><span class="line">&lt;value&gt;/home/rack_topology.sh&lt;/value&gt; </span><br><span class="line">&lt;/property&gt; </span><br></pre></td></tr></table></figure>

<p>rack_topology.sh</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">TOPO=/mnt/d/topology.data</span><br><span class="line"></span><br><span class="line">while [ $# -gt 0 ] ; do</span><br><span class="line">  nodeArg=$1</span><br><span class="line">  result=`awk -v var=$&#123;nodeArg&#125; &#x27;$1 == var &#123;print $2&#125;&#x27; $&#123;TOPO&#125;`</span><br><span class="line">  shift</span><br><span class="line">  if [ -z &quot;$result&quot; ] ; then</span><br><span class="line">    echo -n &quot;/default/rack &quot;</span><br><span class="line">  else</span><br><span class="line">    echo -n &quot;$result &quot;</span><br><span class="line">  fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>topology.data</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hadoopdata1.com     /dc1/rack1</span><br><span class="line">hadoopdata1         /dc1/rack1</span><br><span class="line">10.1.1.1            /dc1/rack2</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">rack = &#123;dn178.tj&quot;:&quot;rack1&quot;,</span><br><span class="line">        dn187.tj&quot;:&quot;rack2&quot;</span><br><span class="line">        &quot;192.168.1.178&quot;:&quot;rack1&quot;,</span><br><span class="line">        &quot;192.168.1.187&quot;:&quot;rack2&quot;,</span><br><span class="line">        &#125;</span><br><span class="line">if __name__==&quot;__main__&quot;:</span><br><span class="line">    print &quot;/&quot; + rack.get(sys.argv[1],&quot;rack0&quot;)</span><br></pre></td></tr></table></figure>


<h2 id="小文件合并"><a href="#小文件合并" class="headerlink" title="小文件合并"></a>小文件合并</h2><p><a target="_blank" rel="noopener" href="http://hadoop.apache.org/docs/current/hadoop-archives/HadoopArchives.html">http://hadoop.apache.org/docs/current/hadoop-archives/HadoopArchives.html</a></p>
<h2 id="短路读"><a href="#短路读" class="headerlink" title="短路读"></a>短路读</h2><p><a target="_blank" rel="noopener" href="https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/ShortCircuitLocalReads.html">https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/ShortCircuitLocalReads.html</a><br><a target="_blank" rel="noopener" href="https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/NativeLibraries.html">https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/NativeLibraries.html</a></p>
<h2 id="外置客户端配置withKerberos"><a href="#外置客户端配置withKerberos" class="headerlink" title="外置客户端配置withKerberos"></a>外置客户端配置withKerberos</h2><p>check:  yarn app -list &amp;&amp; hdfs dfs -ls .</p>
<p>core-site.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">configuration</span>  <span class="attr">xmlns:xi</span>=<span class="string">&quot;http://www.w3.org/2001/XInclude&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://xx<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--kerberos认证环境--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.security.authentication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>kerberos<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 用于支持同时访问kerberos和simple证环境   --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>ipc.client.fallback-to-simple-auth-allowed<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>hdfs-site.xml</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line"></span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;dfs.nameservices&lt;/name&gt;</span><br><span class="line">&lt;value&gt;xx&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;property&gt;</span><br><span class="line">&lt;name&gt;dfs.ha.namenodes.xx&lt;/name&gt;</span><br><span class="line">&lt;value&gt;nn1,nn2&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;name&gt;dfs.namenode.rpc-address.xx.nn1&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;h1:8020&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;name&gt;dfs.namenode.rpc-address.xx.nn2&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;h2:8020&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line"> &lt;property&gt;</span><br><span class="line">      &lt;name&gt;dfs.client.failover.proxy.provider.xx&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"></span><br><span class="line">&lt;property&gt;</span><br><span class="line">  &lt;name&gt;dfs.namenode.kerberos.principal&lt;/name&gt;</span><br><span class="line">  &lt;value&gt;nn/_HOST@HLWKDC&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<p>yarn-site.xml</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line"> &lt;property&gt;</span><br><span class="line">      &lt;name&gt;yarn.resourcemanager.ha.enabled&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;true&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">    &lt;property&gt;</span><br><span class="line">      &lt;name&gt;yarn.resourcemanager.ha.rm-ids&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;rm1,rm2&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line"> &lt;property&gt;</span><br><span class="line">      &lt;name&gt;yarn.resourcemanager.hostname.rm1&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;h1-yy&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">    &lt;property&gt;</span><br><span class="line">      &lt;name&gt;yarn.resourcemanager.hostname.rm2&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;h2&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line"> &lt;property&gt;</span><br><span class="line">      &lt;name&gt;yarn.client.failover-proxy-provider&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;org.apache.hadoop.yarn.client.ConfiguredRMFailoverProxyProvider&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">   &lt;property&gt;</span><br><span class="line">      &lt;name&gt;yarn.resourcemanager.principal&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;rm/_HOST@xx&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<p>mapred-site.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.job.queuename<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>root.xx<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.cluster.local.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>/data/soft/hadoop/mrLocalTmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.application.classpath<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>$HADOOP_HOME/share/hadoop/mapreduce/*:$HADOOP_HOME/share/hadoop/mapreduce/lib/*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">&lt;!-- local模式下不生效，限定为1，见源码org.apache.hadoop.mapred.LocalClientProtocolProvider--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.local.map.tasks.maximum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>10<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.local.reduce.tasks.maximum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>10<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>hive-site.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://a:3306,b:3306,c:3306/hive?autoReconnect=true<span class="symbol">&amp;amp;</span>createDatabaseIfNotExist=true<span class="symbol">&amp;amp;</span>useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=utf-8<span class="symbol">&amp;amp;</span>failOverReadOnly=false<span class="symbol">&amp;amp;</span>useSSL=false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>xxx<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>xxx<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.sasl.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.kerberos.principal<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>hive/x@x<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.uris<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">value</span>&gt;</span>thrift://a:9083,thrift://b:9083,thrift://c:9083<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.authentication.kerberos.principal<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hive/gzhlwtz@HLWKDC<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">./start-thriftserver.sh \</span><br><span class="line">--deploy-mode client \</span><br><span class="line">--conf spark.driver.host=ip \</span><br><span class="line">--name SparkJDBC \</span><br><span class="line">--driver-memory 2g --executor-memory 4g --executor-cores 5 --num-executors 2 \</span><br><span class="line">--hiveconf hive.server2.thrift.port=10001 \</span><br><span class="line">--hiveconf hive.server2.authentication.kerberos.principal=x@x \</span><br><span class="line">--hiveconf hive.server2.authentication.kerberos.keytab=/home/x.keytab \</span><br><span class="line">--hiveconf hive.server2.enable.doAs=false </span><br></pre></td></tr></table></figure>


<h1 id="修改副本数"><a href="#修改副本数" class="headerlink" title="修改副本数"></a>修改副本数</h1><p>（部分节点无法访问时 临时增加副本提供访问能力）</p>
<p>hdfs dfs -setrep 4 /hive/…</p>
<h1 id="distcp"><a href="#distcp" class="headerlink" title="distcp"></a>distcp</h1><h2 id="指定队列"><a href="#指定队列" class="headerlink" title="指定队列"></a>指定队列</h2><p>hadoop distcp -Dmapred.job.queue.name=root.default …<br>hadoop distcp -Dmapreduce.job.queuename …</p>
<h2 id="对拷sftp"><a href="#对拷sftp" class="headerlink" title="对拷sftp"></a>对拷sftp</h2><p>sftpRemote=”/xxx”<br>sftp_user=”xxx”<br>sftp_pw=’xxx’  ##服务器密码<br>sftp_ip=””<br>sftp_port=””</p>
<p>hadoop distcp -D fs.sftp.impl=org.apache.hadoop.fs.sftp.SFTPFileSystem hdfs:///hive/warehouse/ads.db/user_label_iop/tp=202309  sftp://${sftp_user}:${sftp_pw}@${sftp_ip}:${sftp_port}${sftpRemote}/tpftp=202309</p>
<h2 id="同时访问两个HA集群"><a href="#同时访问两个HA集群" class="headerlink" title="同时访问两个HA集群"></a>同时访问两个HA集群</h2><p><code>core-site.xml</code><br>配置的当前客户端默认使用的nameservice</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;</span><br><span class="line"> &lt;name&gt;fs.defaultFS&lt;/name&gt;</span><br><span class="line"> &lt;value&gt;hdfs://nameservice1&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>

<p><code>hdfs-site.xml</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">&lt;!-- services --&gt;</span><br><span class="line">&lt;!-- local sevice and remote service --&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">      &lt;name&gt;dfs.nameservices&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;ns1,ns8&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"> </span><br><span class="line">&lt;!-- remote namespace ns8 --&gt;</span><br><span class="line">&lt;!-- service ns8 --&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">	&lt;name&gt;dfs.ha.namenodes.ns8&lt;/name&gt;</span><br><span class="line">	&lt;value&gt;nn1,nn2&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">	&lt;name&gt;dfs.namenode.rpc-address.ns8.nn1&lt;/name&gt;</span><br><span class="line">	&lt;value&gt;192.168.100.1:8020&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">	&lt;name&gt;dfs.namenode.rpc-address.ns8.nn2&lt;/name&gt;</span><br><span class="line">	&lt;value&gt;192.168.100.2:8020&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">	&lt;name&gt;dfs.namenode.http-address.ns8.nn1&lt;/name&gt;</span><br><span class="line">	&lt;value&gt;192.168.100.1:50070&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">	&lt;name&gt;dfs.namenode.http-address.ns8.nn2&lt;/name&gt;</span><br><span class="line">	&lt;value&gt;192.168.100.2:50070&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.client.failover.proxy.provider.ns8&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&lt;!-- local namespace ns1 --&gt;</span><br><span class="line">&lt;!-- service ns1 --&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">      &lt;name&gt;dfs.internal.nameservices&lt;/name&gt;</span><br><span class="line">      &lt;value&gt;ns1&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.ha.namenodes.ns1&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;nn1,nn2&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.namenode.rpc-address.ns1.nn1&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;dev01:8020&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.namenode.rpc-address.ns1.nn2&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;dev02:8020&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.namenode.http-address.ns1.nn1&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;dev01:50070&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.namenode.http-address.ns1.nn2&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;dev02:50070&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.client.failover.proxy.provider.ns1&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -ls /</span><br><span class="line">hadoop fs -ls hdfs://ns1/          ##访问客户端默认的集群 </span><br><span class="line">hadoop fs -ls hdfs://ns8/          ##访问ns8集群</span><br><span class="line"></span><br><span class="line">hadoop distcp -Dmapred.job.queue.name=root.userA -pb \</span><br><span class="line">hdfs://ns1/user/userA/source_path/source_file \</span><br><span class="line">hdfs://ns8/user/userA/dest_path</span><br></pre></td></tr></table></figure>

<h1 id="使用-读取多个枚举值路径"><a href="#使用-读取多个枚举值路径" class="headerlink" title="使用{}读取多个枚举值路径"></a>使用{}读取多个枚举值路径</h1><p><code>$&#123;Burpoint_HDFS_PATH&#125;/source=&#123;$&#123;data_sources&#125;&#125;/platform=*/year=$year/month=$month/day=$day</code></p>
<h1 id="数据丢失处理"><a href="#数据丢失处理" class="headerlink" title="数据丢失处理"></a>数据丢失处理</h1><blockquote>
<p>Safe mode is ON. The reported blocks 3 needs additional 2 blocks to reach the threshold 0.9990 of total blocks 5. The number of live datanodes 2 has reached the minimum number 0. Safe mode will be turned off automatically once the thresholds have been reached.</p>
</blockquote>
<ul>
<li>确定zkfc启动 $HADOOP_HOME/sbin/hadoop-daemon.sh start zkfc</li>
<li>退出安全模式 hdfs dfsadmin -safemode leave</li>
<li>选定ActiveNN hdfs haadmin -failover nn1 nn2 (直接执行hdfs命令会报访问9000端口，standby状态不可读)</li>
<li>检查问题文件 hdfs fsck /</li>
<li>删除问题问题就 hdfs fsck /tmp -delete  </li>
</ul>
<h1 id="HDFS文件清理巡检"><a href="#HDFS文件清理巡检" class="headerlink" title="HDFS文件清理巡检"></a>HDFS文件清理巡检</h1><blockquote>
<p>防止使用者乱放文件</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"># modified 20230303</span><br><span class="line">KNOWN_FILE=&quot;^/data$&quot;</span><br><span class="line">KNOWN_FILE=$KNOWN_FILE&quot;|^/dolphinscheduler$&quot;</span><br><span class="line">KNOWN_FILE=$KNOWN_FILE&quot;|^/flink$&quot;</span><br><span class="line">KNOWN_FILE=$KNOWN_FILE&quot;|^/hive$&quot;</span><br><span class="line">KNOWN_FILE=$KNOWN_FILE&quot;|^/spark$&quot;</span><br><span class="line">KNOWN_FILE=$KNOWN_FILE&quot;|^/tmp$&quot;</span><br><span class="line">KNOWN_FILE=$KNOWN_FILE&quot;|^/user$&quot;</span><br><span class="line">KNOWN_FILE=$KNOWN_FILE&quot;|^/yarn$&quot;</span><br><span class="line">hdfs dfs -ls -C /  |grep -Ev $KNOWN_FILE</span><br><span class="line"></span><br><span class="line">KNOWN_FILE=&quot;^/data/huadan$&quot;</span><br><span class="line">KNOWN_FILE=$KNOWN_FILE&quot;|^/data/env$&quot;</span><br><span class="line">hdfs dfs -ls -C /data  |grep -Ev $KNOWN_FILE</span><br><span class="line"></span><br><span class="line">KNOWN_FILE=&quot;^/dolphinscheduler/hadoop$&quot;</span><br><span class="line">hdfs dfs -ls -C /dolphinscheduler  |grep -Ev $KNOWN_FILE</span><br><span class="line"></span><br><span class="line">KNOWN_FILE=&quot;^/flink/completed-jobs$&quot;</span><br><span class="line">hdfs dfs -ls -C /flink  |grep -Ev $KNOWN_FILE</span><br><span class="line"></span><br><span class="line">KNOWN_FILE=&quot;^/spark/warehouse$&quot;</span><br><span class="line">KNOWN_FILE=$KNOWN_FILE&quot;|^/spark/spark-history$&quot;</span><br><span class="line">KNOWN_FILE=$KNOWN_FILE&quot;|^/spark/spark-jar.zip$&quot;</span><br><span class="line">hdfs dfs -ls -C /spark  |grep -Ev $KNOWN_FILE</span><br><span class="line"></span><br><span class="line">KNOWN_FILE=&quot;^/hive/warehouse$&quot;</span><br><span class="line">KNOWN_FILE=$KNOWN_FILE&quot;|^/hive/tmp$&quot;</span><br><span class="line">hdfs dfs -ls -C /hive  |grep -Ev $KNOWN_FILE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">KNOWN_FILE=&quot;^/hive/warehouse/ads.db$&quot;</span><br><span class="line">KNOWN_FILE=$KNOWN_FILE&quot;|^/hive/warehouse/default.db$&quot;</span><br><span class="line">KNOWN_FILE=$KNOWN_FILE&quot;|^/hive/warehouse/dim.db$&quot;</span><br><span class="line">KNOWN_FILE=$KNOWN_FILE&quot;|^/hive/warehouse/dm.db$&quot;</span><br><span class="line">KNOWN_FILE=$KNOWN_FILE&quot;|^/hive/warehouse/dw.db$&quot;</span><br><span class="line">KNOWN_FILE=$KNOWN_FILE&quot;|^/hive/warehouse/dwd.db$&quot;</span><br><span class="line">KNOWN_FILE=$KNOWN_FILE&quot;|^/hive/warehouse/lg.db$&quot;</span><br><span class="line">KNOWN_FILE=$KNOWN_FILE&quot;|^/hive/warehouse/mid.db$&quot;</span><br><span class="line">KNOWN_FILE=$KNOWN_FILE&quot;|^/hive/warehouse/ods.db$&quot;</span><br><span class="line">KNOWN_FILE=$KNOWN_FILE&quot;|^/hive/warehouse/oracle_orc_fromdatax.db$&quot;</span><br><span class="line">KNOWN_FILE=$KNOWN_FILE&quot;|^/hive/warehouse/tmp.db$&quot;</span><br><span class="line">hdfs dfs -ls -C /hive/warehouse  |grep -Ev $KNOWN_FILE</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="balance"><a href="#balance" class="headerlink" title="balance"></a>balance</h1><p>hdfs balancer -threshold 10 -blockpools BP-55455179-10.27.48.1-1677135619428 -source 10.27.48.20</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[-exclude [-f &lt;hosts-file&gt; | &lt;comma-separated list of hosts&gt;]]</span><br><span class="line">[-include [-f &lt;hosts-file&gt; | &lt;comma-separated list of hosts&gt;]]</span><br><span class="line">[-source [-f &lt;hosts-file&gt; | &lt;comma-separated list of hosts&gt;]]</span><br><span class="line">[-blockpools &lt;comma-separated list of blockpool ids&gt;]</span><br><span class="line">[-idleiterations &lt;idleiterations&gt;]</span><br></pre></td></tr></table></figure>


<h1 id="清空回收站"><a href="#清空回收站" class="headerlink" title="清空回收站"></a>清空回收站</h1><p>hdfs dfs -expunge</p>
<h1 id="Web页面安全"><a href="#Web页面安全" class="headerlink" title="Web页面安全"></a>Web页面安全</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.http.filter.initializers<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.security.AuthenticationFilterInitializer<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.http.authentication.type<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">     <span class="tag">&lt;<span class="name">value</span>&gt;</span>simple<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.http.authentication.signature.secret.file<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">value</span>&gt;</span>/opt/hadoop/secret/hadoop-http-auth-signature-secret<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.http.authentication.simple.anonymous.allowed<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>访问地址为secret中写入的字符 <code>http://127.0.0.1:9870?user.name=qazwsx$123</code></p>
<h2 id="通过nginx配置用户名密码"><a href="#通过nginx配置用户名密码" class="headerlink" title="通过nginx配置用户名密码"></a>通过nginx配置用户名密码</h2><p>yum install httpd-tools<br>yum install httpd<br>启动 httpd 命令：service httpd restart<br>httpd 的默认安装目录在：/etc/httpd/<br>关于其配置可以自行查看 /etc/httpd/httpd.conf 文件<br>如果启动成功后，访问服务器的80端口会出现apache的welcome界面。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 设置用户名，密码 生成 db文件</span><br><span class="line">htpasswd -c /usr/local/nginx/passwd.db username password</span><br><span class="line"># 查看生成的db文件内容</span><br><span class="line">cat /usr/nginx/conf/htpasswd.users</span><br><span class="line"></span><br><span class="line">vi /usr/local/nginx/conf/nginx.conf</span><br><span class="line">    server &#123;</span><br><span class="line">            listen 50070;</span><br><span class="line">            server_name localhost;</span><br><span class="line"></span><br><span class="line">            location / &#123;</span><br><span class="line">                    auth_basic &quot;hadoop001&quot;; # 虚拟主机认证命名</span><br><span class="line">                    auth_basic_user_file /usr/local/nginx/passwd.db; # 虚拟主机用户名密码认证数据库</span><br><span class="line">                    proxy_pass http://127.0.0.1:9870; # hadoop 访问</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="GroupMapping配置"><a href="#GroupMapping配置" class="headerlink" title="GroupMapping配置"></a>GroupMapping配置</h1><p>参考<a target="_blank" rel="noopener" href="https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/GroupsMapping.html">Hadoop官网</a>配置分组，如果没有配置就fallback到User级别</p>
<p>在<code>core-site.xml</code>优先按照配置的静态映射确定组，默认值为<code>dr.who=;</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.user.group.static.mapping.overrides<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>user1=group1,group2;user2=;user3=group2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>无匹配的静态项则使用配置映射service provider为<code>hadoop.security.group.mapping</code></p>
<p>配置静态映射后刷新配置：<br><code>hdfs dfsadmin -refreshUserToGroupsMappings</code></p>
<p>–实测只配置nn不成功</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zwCHAN/p/4686054.html">hadoop用户和权限 - 过雁 - 博客园 (cnblogs.com)</a></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/CheatSheet/">CheatSheet</a>
</div>


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://kevinjmh.github.io/2022/01/20/CheatSheet/storage/hdfs/" data-title="hdfs | Manhua" data-tsina="" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2022/01/20/CheatSheet/visualization/metabase/" title="metabase">
  <strong>上一篇：</strong><br/>
  <span>
  metabase</span>
</a>
</div>


<div class="next">
<a href="/2022/01/20/CheatSheet/scheduler/dolphinscheduler/dolphinscheduler/"  title="dolphinscheduler">
 <strong>下一篇：</strong><br/> 
 <span>dolphinscheduler
</span>
</a>
</div>

</nav>

	

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="kevinjmh" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
			<li><a href="/categories/Application/" title="Application">Application<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/BigData/" title="BigData">BigData<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/CheatSheet/" title="CheatSheet">CheatSheet<sup>21</sup></a></li>
		  
		
		  
			<li><a href="/categories/Info/" title="Info">Info<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/慢话/" title="慢话">慢话<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/carbondata/" title="carbondata">carbondata<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/project/" title="project">project<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/rdma/" title="rdma">rdma<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/software/" title="software">software<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/recommendation/" title="recommendation">recommendation<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/markdown/" title="markdown">markdown<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/carbon/" title="carbon">carbon<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/spark/" title="spark">spark<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/hadoop/" title="hadoop">hadoop<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="http://www.cnblogs.com/manhua" target="_blank" title="cnBlogs">cnBlogs</a>
            
          </li>
        
    </ul>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Manhua Jiang. <br/>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/443181876" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/kevinjmh" target="_blank" class="icon-github" title="github"></a>
		
		
		
		<a href="https://twitter.com/jiangmanhua" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/jiangmanhua" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2023 
		
		<a href="/about" target="_blank" title="Manhua">Manhua</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>









<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
